<!DOCTYPE html>
<html>
    <head>
	<meta charset='UTF-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<meta name='description' content='Blog de tecnologia do Elo7, mantido pelo nosso time de Engenharia, compartilhando conhecimento e mostrando como é o dia a dia de um colaborador fora de série.'>
	<meta name='google-site-verification' content='NqCILBTY8B8P-r_KF8BSZKH9kUQgQOEbXJvEMaB33vw'>
	<meta name='google-site-verification' content='cKh-stJM3_ENNfMjaBIIyYiDgMXZFpRkoH8eQTcPwhM' />
	<meta name="google-site-verification" content="6Er6NBhORIKrEwdS46h772O_7LTE9vWgZjwtzuZ5gpQ" />
	<meta name='theme-color' content='#FDC24F'>
	<meta name='keywords' content='Elo7,tecnologia,post,desenvolvimento,blog,scala,programacao-funcional,guice,'>
	<meta name='language' content='pt-br'>
	<meta name='title' content='Elo7 Tech - Injeção de Dependência em Scala - Parte 1'>
	<meta name='apple-mobile-web-app-title' content='Elo7 Tech - Injeção de Dependência em Scala - Parte 1'>
	<meta name='mobile-web-app-capable' content='yes'>

	<meta property='fb:app_id' content='644444999041914'>
	<meta property='fb:admins' content='100003324447975'>

	<meta property='og:site_name' content='Elo7 Tech'>
	<meta property='og:image' content='https://blog.elo7.dev/images/cover/injecao-de-dependencia-em-scala-parte-1.png'>
	<meta property='og:type' content='website'>
	<meta property='og:title' content='Elo7 Tech - Injeção de Dependência em Scala - Parte 1'>
	<meta property='og:url' content='https://blog.elo7.dev/injecao-de-dependencia-em-scala-parte-1/'>
	<meta property='og:description' content='Blog de tecnologia do Elo7, mantido pelo nosso time de Engenharia, compartilhando conhecimento e mostrando como é o dia a dia de um colaborador fora de série.'>

	<meta name='twitter:widgets:csp' content='on'>
	<meta name='twitter:card' content='summary_large_image'>

	<meta property='twitter:title' content='Elo7 Tech - Injeção de Dependência em Scala - Parte 1'>
	<meta property='twitter:domain' content='https://blog.elo7.dev/'>
	<meta property='twitter:url' content='https://blog.elo7.dev/injecao-de-dependencia-em-scala-parte-1/'>
	<meta property='twitter:description' content='Blog de tecnologia do Elo7, mantido pelo nosso time de Engenharia, compartilhando conhecimento e mostrando como é o dia a dia de um colaborador fora de série.'>
	<meta property='twitter:image' content='https://blog.elo7.dev/images/cover/injecao-de-dependencia-em-scala-parte-1.png'>

	<link rel='canonical' href='https://blog.elo7.dev/injecao-de-dependencia-em-scala-parte-1/'>
	<title>Elo7 Tech - Injeção de Dependência em Scala - Parte 1</title>
	<link rel='stylesheet' href='https://blog.elo7.dev/css/reset.css'>
	<link rel='stylesheet' href='https://blog.elo7.dev/css/vendor/highlight.css' >
	<link rel='stylesheet' href='https://blog.elo7.dev/css/main.css' >
	<link rel='stylesheet' href='https://blog.elo7.dev/css/posts.css' >
	<link rel='stylesheet' href='https://blog.elo7.dev/css/post.css' >
	<link rel='stylesheet' href='https://blog.elo7.dev/css/publisher.css' >
	<link rel='icon' href='https://blog.elo7.dev/images/favicon/favicon-16.png' sizes='16x16'>
	<link rel='icon' href='https://blog.elo7.dev/images/favicon/favicon-32.png' sizes='32x32'>
	<link rel='icon' href='https://blog.elo7.dev/images/favicon/favicon-48.png' sizes='48x48'>
	<link rel='icon' href='https://blog.elo7.dev/images/favicon/favicon-64.png' sizes='64x64'>
	<link rel='icon' href='https://blog.elo7.dev/images/favicon/favicon-96.png' sizes='96x96'>
	<link rel='icon' href='https://blog.elo7.dev/images/favicon/favicon-128.png' sizes='128x128'>
	<link rel='icon' href='https://blog.elo7.dev/images/favicon/favicon-160.png' sizes='160x160'>
	<link rel='icon' href='https://blog.elo7.dev/images/favicon/favicon-192.png' sizes='192x192'>
	<link rel='apple-touch-icon-precomposed' sizes='180x180' href='https://blog.elo7.dev/images/favicon/favicon-180.png'>
	<link rel='apple-touch-icon-precomposed' sizes='152x152' href='https://blog.elo7.dev/images/favicon/favicon-152.png'>
	<link rel='apple-touch-icon-precomposed' sizes='144x144' href='https://blog.elo7.dev/images/favicon/favicon-144.png'>
	<link rel='apple-touch-icon-precomposed' sizes='120x120' href='https://blog.elo7.dev/images/favicon/favicon-120.png'>
	<link rel='apple-touch-icon-precomposed' sizes='114x114' href='https://blog.elo7.dev/images/favicon/favicon-114.png'>
	<link rel='apple-touch-icon-precomposed' sizes='76x76' href='https://blog.elo7.dev/images/favicon/favicon-76.png'>
	<link rel='apple-touch-icon-precomposed' sizes='72x72' href='https://blog.elo7.dev/images/favicon/favicon-72.png'>
	<link rel='apple-touch-icon-precomposed' sizes='60x60' href='https://blog.elo7.dev/images/favicon/favicon-60.png'>
	<link rel='apple-touch-icon-precomposed' sizes='57x57' href='https://blog.elo7.dev/images/favicon/favicon-57.png'>
	<link rel='apple-touch-icon-precomposed' href='https://blog.elo7.dev/images/favicon/favicon-precomposed.png'>
	<script>window.addEventListener('error', window.__e=function f(e){f.q=f.q||[];f.q.push(e)});</script>
	<script src='/js/vendor/async-define.js'></script>
</head>

    <body data-env='production' data-ga-code='UA-3692628-29'>
        <meta name='page_type' content='post'>
        <meta name='category' content='back-end'>
        <header class='left-pane'>
    <div class='logo-container'>
        <a rel='home' itemprop='url' href='https://blog.elo7.dev/' class='logo'>Tech Blog Elo7</a>
    </div>
    <div class='navigation'>
        <input id='categories-switch' type='checkbox' class='categories-switch'>
        <label for='categories-switch' class='selectable'>
            <h2 class='nav-title'>Categorias</h2>
        </label>
        <nav aria-label='Navegue pelas categorias do nosso blog' class='nav-list nav-category'>
            
                <a href='/categoria/back-end' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Back End</a></span>
                </a>
            
                <a href='/categoria/big-data' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Big Data</a></span>
                </a>
            
                <a href='/categoria/cultura' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Cultura</a></span>
                </a>
            
                <a href='/categoria/design' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Design</a></span>
                </a>
            
                <a href='/categoria/devops' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Devops</a></span>
                </a>
            
                <a href='/categoria/eventos' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Eventos</a></span>
                </a>
            
                <a href='/categoria/front-end' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Front End</a></span>
                </a>
            
                <a href='/categoria/machine-learning' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Machine Learning</a></span>
                </a>
            
                <a href='/categoria/mobile' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Mobile</a></span>
                </a>
            
                <a href='/categoria/vagas' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Vagas</a></span>
                </a>
            
            <a href='/talks' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                <span itemprop='name'>Palestras</span>
            </a>
        </nav>
    </div>
    <div class='navigation'>
        <input id='more-switch' type='checkbox' class='more-switch'>
        <label for='more-switch' class='selectable'>
            <h2 class='nav-title'>Veja também</h2>
        </label>
        <nav class='nav-list nav-more' aria-label='Navegue pelos links relacionados ao Elo7'>
            <a itemprop='relatedLink' href='/meetups'>
                <span itemprop='name'>Meetups no Elo7</span>
            </a>
            <a itemprop='relatedLink' href='http://carreira.elo7.com.br/engenharia/' target='_blank'>
                <span itemprop='name'>A engenharia</span>
            </a>
            <a itemprop='relatedLink' href='http://carreira.elo7.com.br/' target='_blank'>
                <span itemprop='name'>Carreiras</span>
            </a>
            <a itemprop='relatedLink' href='http://elo7.com.br/' target='_blank'>
                <span itemprop='name'>Elo7</span>
            </a>
        </nav>
    </div>
    <div class='social'>
        <a title='Github do Elo7' rel='external' itemprop='relatedLink' href='https://github.com/elo7' target='_blank' class='github'>Github do Elo7</a>
        <a title='Twitter do Elo7' rel='external' itemprop='relatedLink' href='https://twitter.com/elo7tech' target='_blank' class='twitter'>Twitter do Elo7</a>
        <a title='RSS do Elo7' rel='external' itemprop='relatedLink' href='https://blog.elo7.dev/index.xml' target='_blank' class='rss'>RSS do Elo7</a>
        <a title='Newsletter do Elo7' rel='external' itemprop='relatedLink' href='http://eepurl.com/cVUwvH' target='_blank' class='email'>Newsletter do Elo7</a>
    </div>
</header>

        <main aria-label='Conteúdo principal' itemscope itemtype='http://schema.org/Blog'>
            <article itemprop='blogPost' itemscope itemtype='http://schema.org/BlogPosting' class='post-main'>
                <figure class='cover-image' itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
                    <img src='/images/cover/injecao-de-dependencia-em-scala-parte-1.png' alt='Injeção de Dependência em Scala - Parte 1' itemprop="url">
                </figure>
                <div class='post-content'>
                    <h1 itemprop='name' class='title'>Injeção de Dependência em Scala - Parte 1</h1>
                    <div class='post-meta'>
                        <p class='date'>
                            Publicado em:
                            <time class='date'
    datetime='2019-07-01 00:00:00 &#43;0000 UTC'
    aria-label='01 de julho de 2019'>
    01/07/2019
    <meta itemprop='datePublished' content='Mon Jul 01 2019 00:00:00 GMT&#43;0000 (UTC)'/>
    <meta itemprop='dateModified' content='Mon Jul 01 2019 00:00:00 GMT&#43;0000 (UTC)'>
    <meta name='date' content='2019-07-01'>
</time>

                        </p>

                        <article>
                            
                                <a data-author='rodrigovedovato' itemprop='author' itemscope itemtype='http://schema.org/Person' rel='author' href='/autor/rodrigovedovato/' class='author'>
                                    <meta name='author' itemprop='url' content='/autor/rodrigovedovato'>
                                    <img class='hide avatar' width='50px' height='50px' itemprop='image'>
                                    <p itemprop='name' class='publisher' data-author='rodrigovedovato'>@rodrigovedovato</p>
                                </a>
                            

                            <meta itemprop='worksFor' content='Elo7 Serviços de Informática SA'>
                        </article>
                    </div>
                    <div itemprop='articleBody'>
                        

<h2 id="scala-no-elo7"><em>Scala no Elo7</em></h2>

<p><em>Antes restrito basicamente às áreas de Data Science e Data Engineering da empresa, o uso de Scala está sendo expandido para outras áreas de backend aqui no Elo7 em 2019. Como compartilhar conhecimento faz parte do nosso DNA, iremos realizar posts contando as experiências que temos com a linguagem e um pouco sobre como resolvemos diferentes situações que aparecem no dia-a-dia.</em></p>

<h2 id="injeção-de-dependência">Injeção de dependência</h2>

<p>Injeção de dependência (ou DI) é um dos padrões mais básicos utilizados por desenvolvedores em diferentes linguagens, e no Scala não poderia ser diferente. Apesar de ser uma linguagem funcional, a linguagem ainda traz diversas características de Orientação a Objetos. E isso significa que modelos clássicos de DI, como a injeção das dependências por meio do construtor, funcionam!</p>

<pre><code class="language-scala">case class UserInfo(account: String, password: String)

trait UserService {
    def getUserInfo(account: String): UserInfo
}

class UserServiceComponent extends UserService {
    override def getUserInfo(account: String): UserInfo = UserInfo(account, &quot;123&quot;)
}

class LoginFacade(userService: UserService) {
    def login(account: String, password: String): Boolean = {
        userService.getUserInfo(account).password == password
    }
}

class Application extends App {
   val loginFacade = new LoginFacade(new UserServiceComponent())
   println(loginFacade.login(&quot;Rodrigo&quot;, &quot;123&quot;))
}
</code></pre>

<p>Mais clássico impossível, certo? Neste padrão, deixamos explícito no construtor da classe <code>LoginFacade</code> que ela possui uma dependência com uma implementação de <code>UserService</code>, mas há alguns problemas aí: toda a execução e definição do serviço está no método main, mas e se o método <code>login</code> fosse utilizado dentro de um contexto mais complexo?</p>

<pre><code class="language-scala">class HomeController {
  val loginFacade = new LoginFacade(new UserServiceComponent())

  def autenticarUsuario(usuario: String, senha: String): String = {
    if (loginFacade.login(usuario, senha)) {
      s&quot;Olá, $usuario&quot;
    } else {
      &quot;Erro de login&quot;
    }
  }
}
</code></pre>

<p>Com certeza precisaríamos escrever testes unitários para o método <code>autenticarUsuario</code>. Mas como fazer para simular o comportamento da <code>LoginFacade</code>, já que a instância está presa à implementação da classe <code>UserServiceComponent</code>?. Podemos, é claro, injetar a instância da dependência via construtor, mas isso só passaria o problema para outra camada.  Felizmente, há diferentes soluções para este problema.</p>

<h3 id="guice-ou-o-jeito-java-de-injetar-dependências">Guice ou (O jeito Java de injetar dependências)</h3>

<p>Um velho conhecido dos programadores Java é o Guice, framework de injeção de dependência criado pelo Google. Através do uso de annotations e algumas interfaces, é possível injetar suas dependências de forma dinâmica.</p>

<p>Para usá-lo na nossa aplicação Scala, tudo o que temos que fazer é adicionar uma dependência ao pacote  <code>com.google.inject:guice</code> no nosso arquivo build.sbt</p>

<pre><code class="language-scala">lazy  val  root  = (project in file(&quot;.&quot;))
  .settings(
    name :=  &quot;artigo-di&quot;,
    libraryDependencies ++=  Seq(
      &quot;com.google.inject&quot;  %  &quot;guice&quot;  %  &quot;4.2.2&quot;,
      scalaTest %  Test
  )
)
</code></pre>

<p>Feito isso, chegou a hora de alterar nosso código!</p>

<p>A primeira classe que temos que alterar, é a <code>LoginFacade</code>, anotando o seu construtor com a <em>annotation</em> <code>com.google.inject.Inject</code></p>

<pre><code class="language-scala">trait  LoginFacadeT {
  def  login(account: String, password: String):  Boolean
}

class LoginFacade @Inject()(userService: UserService) extends LoginFacadeT {
    override def login(account: String, password: String): Boolean = {
        userService.getUserInfo(account).password == password
    }
}
</code></pre>

<p>Desta forma, instruímos ao Guice que será necessário buscar em seu registro uma instância da <em>trait</em> <code>UserService</code>. Veja, também, que criamos uma nova interface, a <code>LoginFacadeT</code>. Essa interface é necessária pois a classe <code>HomeController</code> será dependente desta interface.</p>

<pre><code class="language-scala">class HomeController(facade: LoginFacadeT) {
  def autenticarUsuario(usuario: String, senha: String): String = {
    if (facade.login(usuario, senha)) {
      s&quot;Olá, $usuario&quot;
    } else {
      &quot;Erro de login&quot;
    }
  }
}
</code></pre>

<p>Veja que, neste caso, não anotamos o construtor da nossa classe.  Neste caso específico, iremos deixar assim para fins de demonstração, mas, idealmente, também deveríamos construir nossa Controller dinamicamente.</p>

<p>Por fim, devemos adicionar uma classe que implemente a interface <code>AbstractModule</code>. Esta classe fica responsável por registrar todas as interfaces com suas respectivas implementações.</p>

<pre><code class="language-scala">class DependencyInjectionWithGuiceModule extends AbstractModule {
    override def configure(): Unit = {
        bind(classOf[UserService]).to(classOf[BasicUserService])
        bind(classOf[LoginFacadeT]).to(classOf[LoginFacade])
    }
}
</code></pre>

<p>Finalmente, chegou a hora de ligar todos os pontos na nossa aplicação. O resultado fica assim:</p>

<pre><code class="language-scala">object DependencyInjectionWithGuice extends App {
    val injector = Guice.createInjector(new DependencyInjectionWithGuiceModule())
    lazy val loginFacade: LoginFacadeT = injector.getInstance(classOf[LoginFacadeT])

    val homeController = new HomeController(loginFacade)
    println(homeController.authenticateUser(&quot;Rodrigo&quot;, &quot;123&quot;))
}
</code></pre>

<p>Desta forma, desacoplamos completamente nosso código. Para realizar teste unitários, basta implementarmos <em>mocks</em> das interfaces que criamos e registrá-los em um módulo a parte.</p>

<h2 id="na-próxima-parte">Na próxima parte..</h2>

<p>Apesar de funcionar e ser como grande parte da indústria lida com a injeção de dependência, o ecossistema Scala e conceitos de programação funcional possuem formas interessantes e bem mais elegantes de lidar com injeção de dependência. Na próxima parte, iremos conhecê-las!</p>


                        <ul class='tag-list'>
                            
                                <li>
                                    <a href='/tags/scala/'>scala</a>
                                </li>
                            
                                <li>
                                    <a href='/tags/programacao-funcional/'>programacao-funcional</a>
                                </li>
                            
                                <li>
                                    <a href='/tags/guice/'>guice</a>
                                </li>
                            
                        </ul>
                        <section class='share'>
                            <a href='#share' class='share-post hide' title='Clique aqui para compartilhar esse post'>Compartilhe</a>
                            <div class='social-share'>
                                <a href='https://www.facebook.com/dialog/share?app_id=644444999041914&href=https%3a%2f%2fblog.elo7.dev%2finjecao-de-dependencia-em-scala-parte-1%2f&display=popup' rel='noopener' target='_blank' class='link-share facebook' title='Clique para compartilhar no Facebook'>
                                    Compartilhar no facebook
                                </a>
                                <a href='https://twitter.com/intent/tweet?text=inje%25C3%25A7%25C3%25A3o-de-depend%25C3%25AAncia-em-scala-parte-1&url=https%3a%2f%2fblog.elo7.dev%2finjecao-de-dependencia-em-scala-parte-1%2f&hashtags=elo7tech' rel='noopener' target='_blank' class='link-share twitter' title='Clique para compartilhar no Twitter'>
                                    Compartilhar no twitter
                                </a>
                                <a href='https://blog.elo7.dev/injecao-de-dependencia-em-scala-parte-1/?utm_source=share&utm_medium=copy' class='link-share hide copy' title='Clique para copiar a url'>
                                    Copiar URL
                                </a>
                                <span class='copy-success'>Link copiado</span>
                                <input type='url' value='https://blog.elo7.dev/injecao-de-dependencia-em-scala-parte-1/?utm_source=share&utm_medium=copy' class='link-input'>
                            </div>
                        </section>
                    </div>
                    <meta itemprop='headline' content='Este artigo de duas partes irá abordar diferentes formas de resolver injeção de dependência em Scala, e como a linguagem e a programação funcional podem nos ajudar.'/>
                    <span itemprop='publisher' itemscope itemtype='http://schema.org/Organization'>
                        <meta itemprop='name' content='Elo7 Tech'/>
                        <meta itemprop='url' content='https://blog.elo7.dev/'/>
                        <span itemprop='logo' itemscope itemtype='http://schema.org/ImageObject'>
                            <link href='https://images.elo7.com.br/assets/v3/desktop/png/logo-elo7.png' itemprop='url'/>
                            <meta itemprop='width' content='100px'/>
                            <meta itemprop='height' content='100px'/>
                        </span>
                    </span>
                    <meta itemprop='mainEntityOfPage' content='Elo7 Serviços de Informática SA'/>

                    <div id='disqus_thread'></div>
                </div>
            </article>
        </main>

        <footer itemscope itemtype='http://schema.org/Organization'>
    <a rel='home' itemprop='url' href='https://blog.elo7.dev/' >
        blog.elo7.dev © <script>now = new Date; document.write(now.getFullYear());</script>
    </a>
    <meta itemprop='name' content='Elo7 Serviços de Informática SA'/>
    <section class='footer-social'>
        <a title='Github do Elo7' rel='external' itemprop='url' href='https://github.com/elo7' target='_blank' class='github'>Github do Elo7</a>
        <a title='Twitter do Elo7' rel='external' itemprop='url' href='https://twitter.com/elo7tech' target='_blank' class='twitter'>Twitter do Elo7</a>
        <a title='RSS do Elo7' rel='external' itemprop='url' href='https://blog.elo7.dev/index.xml' target='_blank' class='rss'>RSS do Elo7</a>
        <a title='Newsletter do Elo7' rel='external' itemprop='url' href='http://eepurl.com/cVUwvH' target='_blank' class='email'>Newsletter do Elo7</a>
    </section>
</footer>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script async src='/js/analytics.js'></script>
<script async src='/js/github.js'></script>
<script async src='/js/vendor/events-amd.js'></script>
<script async src='/js/vendor/ajax.js'></script>
<script async src='/js/vendor/doc.js'></script>
<script type='text/x-mathjax-config'>
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ],
            displayMath: [ ['$$','$$'], ['\[','\]'] ],
            processEscapes: true
        },
    });
</script>
<script async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
<script src='/js/vendor/highlight.js'></script>
<script>hljs.initHighlightingOnLoad();</script>


        <script>
            var disqus_shortname = 'engenhariaelo7';
            var disqus_identifier = '2019-07-01 00:00:00 \x2b0000 UTC:\/injecao-de-dependencia-em-scala-parte-1\/';
            var disqus_url = 'https:\/\/blog.elo7.dev\/injecao-de-dependencia-em-scala-parte-1\/';

            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Habilite o JavaScript para ver os comentários</noscript>
        <script async src='/js/post.js'></script>
    </body>
</html>

<!DOCTYPE html>
<html>
    <head>
	<meta charset='UTF-8'>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<meta name='description' content='Blog de tecnologia do Elo7, mantido pelo nosso time de Engenharia, compartilhando conhecimento e mostrando como é o dia a dia de um colaborador fora de série.'>
	<meta name='google-site-verification' content='NqCILBTY8B8P-r_KF8BSZKH9kUQgQOEbXJvEMaB33vw'>
	<meta name='google-site-verification' content='cKh-stJM3_ENNfMjaBIIyYiDgMXZFpRkoH8eQTcPwhM' />
	<meta name="google-site-verification" content="6Er6NBhORIKrEwdS46h772O_7LTE9vWgZjwtzuZ5gpQ" />
	<meta name='theme-color' content='#FDC24F'>
	<meta name='keywords' content='Elo7,tecnologia,post,desenvolvimento,blog,cdc,debezium,kafka,mysql,'>
	<meta name='language' content='pt-br'>
	<meta name='title' content='Elo7 Tech - Introdução ao Change Data Capture (CDC)'>
	<meta name='apple-mobile-web-app-title' content='Elo7 Tech - Introdução ao Change Data Capture (CDC)'>
	<meta name='mobile-web-app-capable' content='yes'>

	<meta property='fb:app_id' content='644444999041914'>
	<meta property='fb:admins' content='100003324447975'>

	<meta property='og:site_name' content='Elo7 Tech'>
	<meta property='og:image' content='https://elo7.dev/images/cover/cdc.png'>
	<meta property='og:type' content='website'>
	<meta property='og:title' content='Elo7 Tech - Introdução ao Change Data Capture (CDC)'>
	<meta property='og:url' content='https://elo7.dev/cdc-parte-1/'>
	<meta property='og:description' content='Blog de tecnologia do Elo7, mantido pelo nosso time de Engenharia, compartilhando conhecimento e mostrando como é o dia a dia de um colaborador fora de série.'>

	<meta name='twitter:widgets:csp' content='on'>
	<meta name='twitter:card' content='summary_large_image'>

	<meta property='twitter:title' content='Elo7 Tech - Introdução ao Change Data Capture (CDC)'>
	<meta property='twitter:domain' content='https://elo7.dev/'>
	<meta property='twitter:url' content='https://elo7.dev/cdc-parte-1/'>
	<meta property='twitter:description' content='Blog de tecnologia do Elo7, mantido pelo nosso time de Engenharia, compartilhando conhecimento e mostrando como é o dia a dia de um colaborador fora de série.'>
	<meta property='twitter:image' content='https://elo7.dev/images/cover/cdc.png'>

	<link rel='canonical' href='https://elo7.dev/cdc-parte-1/'>
	<title>Elo7 Tech - Introdução ao Change Data Capture (CDC)</title>
	<link rel='stylesheet' href='https://elo7.dev/css/reset.css'>
	<link rel='stylesheet' href='https://elo7.dev/css/vendor/highlight.css' >
	<link rel='stylesheet' href='https://elo7.dev/css/main.css' >
	<link rel='stylesheet' href='https://elo7.dev/css/posts.css' >
	<link rel='stylesheet' href='https://elo7.dev/css/post.css' >
	<link rel='stylesheet' href='https://elo7.dev/css/publisher.css' >
	<link rel='icon' href='https://elo7.dev/images/favicon/favicon-16.png' sizes='16x16'>
	<link rel='icon' href='https://elo7.dev/images/favicon/favicon-32.png' sizes='32x32'>
	<link rel='icon' href='https://elo7.dev/images/favicon/favicon-48.png' sizes='48x48'>
	<link rel='icon' href='https://elo7.dev/images/favicon/favicon-64.png' sizes='64x64'>
	<link rel='icon' href='https://elo7.dev/images/favicon/favicon-96.png' sizes='96x96'>
	<link rel='icon' href='https://elo7.dev/images/favicon/favicon-128.png' sizes='128x128'>
	<link rel='icon' href='https://elo7.dev/images/favicon/favicon-160.png' sizes='160x160'>
	<link rel='icon' href='https://elo7.dev/images/favicon/favicon-192.png' sizes='192x192'>
	<link rel='apple-touch-icon-precomposed' sizes='180x180' href='https://elo7.dev/images/favicon/favicon-180.png'>
	<link rel='apple-touch-icon-precomposed' sizes='152x152' href='https://elo7.dev/images/favicon/favicon-152.png'>
	<link rel='apple-touch-icon-precomposed' sizes='144x144' href='https://elo7.dev/images/favicon/favicon-144.png'>
	<link rel='apple-touch-icon-precomposed' sizes='120x120' href='https://elo7.dev/images/favicon/favicon-120.png'>
	<link rel='apple-touch-icon-precomposed' sizes='114x114' href='https://elo7.dev/images/favicon/favicon-114.png'>
	<link rel='apple-touch-icon-precomposed' sizes='76x76' href='https://elo7.dev/images/favicon/favicon-76.png'>
	<link rel='apple-touch-icon-precomposed' sizes='72x72' href='https://elo7.dev/images/favicon/favicon-72.png'>
	<link rel='apple-touch-icon-precomposed' sizes='60x60' href='https://elo7.dev/images/favicon/favicon-60.png'>
	<link rel='apple-touch-icon-precomposed' sizes='57x57' href='https://elo7.dev/images/favicon/favicon-57.png'>
	<link rel='apple-touch-icon-precomposed' href='https://elo7.dev/images/favicon/favicon-precomposed.png'>
	<script>window.addEventListener('error', window.__e=function f(e){f.q=f.q||[];f.q.push(e)});</script>
	<script src='/js/vendor/async-define.js'></script>
</head>

    <body data-env='production' data-ga-code='UA-3692628-29'>
        <meta name='page_type' content='post'>
        <meta name='category' content='big-data'>
        <header class='left-pane'>
    <div class='logo-container'>
        <a rel='home' itemprop='url' href='https://elo7.dev/' class='logo'>Tech Blog Elo7</a>
    </div>
    <div class='navigation'>
        <input id='categories-switch' type='checkbox' class='categories-switch'>
        <label for='categories-switch' class='selectable'>
            <h2 class='nav-title'>Categorias</h2>
        </label>
        <nav aria-label='Navegue pelas categorias do nosso blog' class='nav-list nav-category'>
            
                <a href='/categoria/back-end' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Back End</a></span>
                </a>
            
                <a href='/categoria/big-data' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Big Data</a></span>
                </a>
            
                <a href='/categoria/cultura' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Cultura</a></span>
                </a>
            
                <a href='/categoria/design' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Design</a></span>
                </a>
            
                <a href='/categoria/devops' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Devops</a></span>
                </a>
            
                <a href='/categoria/eventos' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Eventos</a></span>
                </a>
            
                <a href='/categoria/front-end' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Front End</a></span>
                </a>
            
                <a href='/categoria/machine-learning' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Machine Learning</a></span>
                </a>
            
                <a href='/categoria/mobile' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Mobile</a></span>
                </a>
            
                <a href='/categoria/vagas' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                    <span itemprop='name'>Vagas</a></span>
                </a>
            
            <a href='/talks' itemscope itemtype='http://schema.org/SiteNavigationElement'>
                <span itemprop='name'>Palestras</span>
            </a>
        </nav>
    </div>
    <div class='navigation'>
        <input id='more-switch' type='checkbox' class='more-switch'>
        <label for='more-switch' class='selectable'>
            <h2 class='nav-title'>Veja também</h2>
        </label>
        <nav class='nav-list nav-more' aria-label='Navegue pelos links relacionados ao Elo7'>
            <a itemprop='relatedLink' href='/meetups'>
                <span itemprop='name'>Meetups no Elo7</span>
            </a>
            <a itemprop='relatedLink' href='http://carreira.elo7.com.br/engenharia/' target='_blank'>
                <span itemprop='name'>A engenharia</span>
            </a>
            <a itemprop='relatedLink' href='http://carreira.elo7.com.br/' target='_blank'>
                <span itemprop='name'>Carreiras</span>
            </a>
            <a itemprop='relatedLink' href='http://elo7.com.br/' target='_blank'>
                <span itemprop='name'>Elo7</span>
            </a>
        </nav>
    </div>
    <div class='social'>
        <a title='Github do Elo7' rel='external' itemprop='relatedLink' href='https://github.com/elo7' target='_blank' class='github'>Github do Elo7</a>
        <a title='Twitter do Elo7' rel='external' itemprop='relatedLink' href='https://twitter.com/elo7tech' target='_blank' class='twitter'>Twitter do Elo7</a>
        <a title='RSS do Elo7' rel='external' itemprop='relatedLink' href='https://elo7.dev/index.xml' target='_blank' class='rss'>RSS do Elo7</a>
        <a title='Newsletter do Elo7' rel='external' itemprop='relatedLink' href='http://eepurl.com/cVUwvH' target='_blank' class='email'>Newsletter do Elo7</a>
    </div>
</header>

        <main aria-label='Conteúdo principal' itemscope itemtype='http://schema.org/Blog'>
            <article itemprop='blogPost' itemscope itemtype='http://schema.org/BlogPosting' class='post-main'>
                <figure class='cover-image' itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
                    <img src='/images/cover/cdc.png' alt='Introdução ao Change Data Capture (CDC)' itemprop="url">
                </figure>
                <div class='post-content'>
                    <h1 itemprop='name' class='title'>Introdução ao Change Data Capture (CDC)</h1>
                    <div class='post-meta'>
                        <p class='date'>
                            Publicado em:
                            <time class='date'
    datetime='2019-09-23 00:00:00 &#43;0000 UTC'
    aria-label='23 de setembro de 2019'>
    23/09/2019
    <meta itemprop='datePublished' content='Mon Sep 23 2019 00:00:00 GMT&#43;0000 (UTC)'/>
    <meta itemprop='dateModified' content='Mon Sep 23 2019 00:00:00 GMT&#43;0000 (UTC)'>
    <meta name='date' content='2019-09-23'>
</time>

                        </p>

                        <article>
                            
                                <a data-author='sardinha' itemprop='author' itemscope itemtype='http://schema.org/Person' rel='author' href='/autor/sardinha/' class='author'>
                                    <meta name='author' itemprop='url' content='/autor/sardinha'>
                                    <img class='hide avatar' width='50px' height='50px' itemprop='image'>
                                    <p itemprop='name' class='publisher' data-author='sardinha'>@sardinha</p>
                                </a>
                            

                            <meta itemprop='worksFor' content='Elo7 Serviços de Informática SA'>
                        </article>
                    </div>
                    <div itemprop='articleBody'>
                        

<p>A atual popularidade do termo <em>Big Data</em> veio acompanhada de diversas <em>buzzwords</em>, entre elas o <em>Change Data Capture</em>, ou simplesmente CDC. Porém esse <em>design pattern</em> é tão antigo quanto os RDBMS, pois os dois estão estritamente ligados.</p>

<p>Como o próprio nome diz, o CDC nada mais é do que uma forma de capturar as mudanças nos dados. Vamos imaginar a seguinte tabela de <code>produto</code>:</p>

<pre><code class="language-sql">CREATE TABLE `produto` (
   id INT(6) UNSIGNED AUTO_INCREMENT PRIMARY KEY,
   nome VARCHAR(30) NOT NULL,
   preco DECIMAL(15,2) NOT NULL,
   quantidade INT NOT NULL,
   data_atualizacao DATETIME
);
</code></pre>

<p>com o seguinte <em>insert</em>:</p>

<pre><code class="language-sql">INSERT INTO `produto` (nome, preco, quantidade, data_atualizacao) VALUES ('Amigurumi do Batman', 79.99, 30, now());
</code></pre>

<table>
<thead>
<tr>
<th>id</th>
<th>nome</th>
<th>preco</th>
<th>quantidade</th>
<th>data_atualizacao</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Amigurumi do Batman</td>
<td>79.99</td>
<td>30</td>
<td>2019-06-01 15:30:00</td>
</tr>
</tbody>
</table>

<p>Suponhamos que o vendedor queira atualizar o valor do produto para <code>59.99</code>. Após a operação de <em>update</em>, teremos o seguinte estado:</p>

<pre><code class="language-sql">UPDATE `produto` SET preco = 59.99 WHERE id = 1;
</code></pre>

<table>
<thead>
<tr>
<th>id</th>
<th>nome</th>
<th>preco</th>
<th>quantidade</th>
<th>data_atualizacao</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Amigurumi do Batman</td>
<td>59.99</td>
<td>30</td>
<td>2019-06-02 19:27:00</td>
</tr>
</tbody>
</table>

<p>Até aí nenhuma novidade, correto? Agora imagine que queremos tirar algumas métricas com base nessa tabela, tais como:</p>

<ul>
<li>Diferença de valor quando o preço é alterado</li>
<li>Velocidade em que o estoque diminui</li>
<li>Qual horário um produto é mais cadastrado/atualizado</li>
</ul>

<p>Apenas com a tabela <code>produto</code> não seria possível, pois sempre armazenamos o último estado do registro, mas não suas alterações.</p>

<p>Para resolver esse tipo de problema, foram criadas as famosas tabelas de histórico. Geralmente são utilizadas <em>triggers</em> do próprio BD para realizar essa tarefa. Esse padrão leva o nome de <a href="https://en.wikipedia.org/wiki/Log_trigger"><em>Log Trigger</em></a>.</p>

<p>Nossa tabela <code>historico_produto</code> teria a seguinte estrutura</p>

<pre><code class="language-sql">CREATE TABLE `historico_produto` (
   id INT(6),
   nome VARCHAR(30) NOT NULL,
   preco DECIMAL(15,2) NOT NULL,
   quantidade INT NOT NULL,
   data_inicio DATETIME,
   data_fim DATETIME
);
</code></pre>

<p>e essas seriam nossas <em>triggers</em>:</p>

<pre><code class="language-sql">/* Trigger  para INSERT */
CREATE TRIGGER HistoricoProdutoInsert AFTER INSERT ON produto FOR EACH ROW BEGIN
   INSERT INTO historico_produto (id, nome, preco, quantidade, data_inicio, data_fim)
   VALUES (New.id, New.nome, New.preco, New.quantidade, now(), NULL);
END;

/* Trigger para UPDATE */
CREATE TRIGGER HistoricoProdutoUpdate AFTER UPDATE ON produto FOR EACH ROW BEGIN
   UPDATE historico_produto
      SET data_fim = now()
   WHERE id = OLD.id
      AND data_fim IS NULL;

   INSERT INTO historico_produto (id, nome, preco, quantidade, data_inicio, data_fim)
   VALUES (New.id, New.nome, New.preco, New.quantidade, now(), NULL);
END;
</code></pre>

<p>Agora vamos refazer as operações e observar como ficaria a tabela de histórico:</p>

<pre><code class="language-sql"> INSERT INTO produto (nome, preco, quantidade, data_atualizacao) VALUES ('Amigurumi do Batman', 79.99, 30, now());
</code></pre>

<p>O <em>insert</em> acima acionará a <em>trigger</em> <code>HistoricoProdutoInsert</code>:</p>

<table>
<thead>
<tr>
<th>id</th>
<th>nome</th>
<th>preco</th>
<th>quantidade</th>
<th>data_inicio</th>
<th>data_fim</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Amigurumi do Batman</td>
<td>79.99</td>
<td>30</td>
<td>2019-06-01 19:27:00</td>
<td>NULL</td>
</tr>
</tbody>
</table>

<p>Agora vamos fazer o <em>update</em> no preço <em>(trigger <code>HistoricoProdutoUpdate</code>)</em></p>

<pre><code class="language-sql">UPDATE produto SET preco = 59.99 WHERE id = 1;
</code></pre>

<table>
<thead>
<tr>
<th>id</th>
<th>nome</th>
<th>preco</th>
<th>quantidade</th>
<th>data_inicio</th>
<th>data_fim</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>Amigurumi do Batman</td>
<td>79.99</td>
<td>30</td>
<td>2019-06-01 19:27:00</td>
<td>2019-06-02 19:27:00</td>
</tr>

<tr>
<td>1</td>
<td>Amigurumi do Batman</td>
<td>59.99</td>
<td>30</td>
<td>2019-06-02 19:27:00</td>
<td>NULL</td>
</tr>
</tbody>
</table>

<p>Podemos ver que a <em>trigger</em> atualizou a coluna <code>data_fim</code> do registro anterior e adicionou um novo registro com as atualizações. Dessa forma, temos todos os dados de alterações que ocorreram no produto e, com algumas <em>queries</em>, podemos responder nossas perguntas. Sempre que quisermos o último snapshot do produto, podemos fazer a query <code>WHERE data_fim = NULL</code>, ou usar a combinação das duas colunas <em>(data_inicio e data_fim)</em> para obter o estado do produto em um determinado dia/horário.</p>

<p>Essa abordagem é bem simples e pode funcionar para muitos casos, mas ela possui um grande problema: <strong>todas as mudanças ficam visíveis apenas no nível do banco de dados, ou seja, a única interação possível com a tabela <code>historico_produto</code> é utilizando <em>queries</em> SQL</strong>. É praticamente impossível um sistema externo reagir à uma mudança no produto. <em>(seria possível apenas fazendo pooling na tabela, mas convenhamos: não é uma boa ideia né?)</em></p>

<p>Como podemos fazer para capturar mudança nos dados e também permitir que sistemas externos reajam à eles? Simples: <strong>eventos!</strong></p>

<p>Eventos representam ações que ocorreram em um determinado momento e permite, de forma assíncrona, que outros sistemas <em>(internos ou externos)</em> reajam à ele. Geralmente esses eventos trafegam em um sistema de mensageria, tais como: Kafka, RabbitMQ, VerneMQ, Amazon Kinesis&hellip;</p>

<p>Os eventos podem trafegar em diversos formatos <em>(JSON, Avro, Parquet&hellip;)</em>, mas para facilitar a visualização, vamos usar JSON. Um exemplo de evento para o <em>update</em> do produto poderia ser</p>

<pre><code class="language-json">{
   &quot;id&quot;: 1,
   &quot;nome&quot;: &quot;Amigurumi do Batman&quot;,
   &quot;preco&quot;: 59.99,
   &quot;quantidade&quot;: 30,
   &quot;data_atualizacao&quot;: &quot;2019-06-01 15:30:00&quot;,
   &quot;operacao&quot;: &quot;update&quot;
}
</code></pre>

<p>e o código para enviar o evento seria parecido com esse:</p>

<pre><code class="language-java">public class RepositorioProduto {

	private Evento evento;

	public void atualiza(final Produto produto) {
		// Salva produto no banco de dados

		//Cria evento
		Map&lt;String, Object&gt; dadosDoEvento = new HashMap&lt;&gt;();
		dadosDoEvento.put(&quot;id&quot;, produto.getId());
		dadosDoEvento.put(&quot;nome&quot;, produto.getNome());
		dadosDoEvento.put(&quot;preco&quot;, produto.getPreco());
		dadosDoEvento.put(&quot;quantidade&quot;, produto.getQuantidade());
		dadosDoEvento.put(&quot;data_atualizacao&quot;, produto.getDataAtualizacao());
		dadosDoEvento.put(&quot;operacao&quot;, &quot;update&quot;);

		//Envia o evento para o sistema de mensageria
		evento.envia(&quot;ProdutoAtualizado&quot;, dadosDoEvento);
	}
}
</code></pre>

<p>Dessa forma conseguimos publicar os eventos com as alterações para quem deseja escutá-los. O evento de <code>ProdutoAtualizado</code> por exemplo, poderia ser utilizado para enviar email marketing avisando os clientes que o preço do produto abaixou.</p>

<p>Essa abordagem resolve o problema das <em>triggers</em>, possibilitando outros sistemas reagirem às mudanças nos dados. Mas ela acarreta em outros problemas:</p>

<ul>
<li>Necessita de um grande conhecimento sobre o sistema que irá emitir os eventos, sabendo exatamente onde dispará-los, caso contrário, poderá haver divergências com o banco de dados</li>
<li>Os famosos &ldquo;updates na mão&rdquo;, que não passam pelo sistema e consequentemente, não irá produzir os eventos necessários</li>
<li>Arquitetura mais complexa do que as <em>triggers</em>, pois é necessário um sistema de mensageria</li>
</ul>

<p>O cenário acima poderia ser evitado se o sistema em questão fosse desenvolvido usando técncias de <a href="https://www.confluent.io/blog/journey-to-event-driven-part-1-why-event-first-thinking-changes-everything"><em>Event Driven</em></a>. Nesse tipo de abordagem, os eventos são considerados cidadãos de primeira classe, ou seja, toda a comunicação é realizada utilizando produtores e consumidores de eventos. Não me aprofundarei mais nesse assunto, pois quero escrever um <em>post</em> só sobre isso no futuro.</p>

<p>Vimos que tanto a abordagem por <em>triggers</em> quanto a por eventos tem suas limitações <em>(o que é perfeitamente normal, afinal, não existe bala de prata)</em>. Mas e se pudéssemos fazer um mix das duas abordagem: pegar a consistência do banco de dados com a mensageria dos eventos? É exatamente isso que os frameworks atuais de CDC fazem. Antes de explicá-los, precisamos entender como funciona a replicação de banco de dados, ou mais especificamente, o <strong><em>binary log (aka binlog)</em></strong>.</p>

<p>Irei explicar como funciona a replicação do MySQL, mas a maioria dos bancos RDBMS seguem o mesmo princípio. Veja a imagem abaixo:</p>

<p><img src="/images/mysql-binlog.png" alt="MySQL Binlog" /></p>

<p>1 - A Master recebe o comando SQL</p>

<p>2 - Após executar o comando, a Master escreve no <em>binlog</em> as alterações feitas</p>

<p>3 - A Slave possui um processo que lê o <em>binlog</em> da Master <em>(3.1)</em> e escreve as alterações em seu <em><a href="https://dev.mysql.com/doc/refman/5.7/en/slave-logs-relaylog.html">relay_log</a> (possui o mesmo formato do binlog) (3.2)</em></p>

<p>4 - A Slave possui outro processo que lê o <em>relay_log</em> <em>(4.1)</em> e aplica as alterações em seu host <em>(4.2)</em></p>

<p><em>(mais detalhes na <a href="https://dev.mysql.com/doc/internals/en/replication.html">documentação oficial</a>)</em></p>

<p>Olhando a imagem acima, podemos afirmar que todas as alterações feitas no banco de dados são escritas no <em>binlog</em>. E se conseguíssemos ler esses dados e mandar para um sistema de mensageria? É exatamente isso que o <a href="https://debezium.io/">Debezium</a> faz.
Atualmente o Debezium é o framework <em>open source</em> mais utilizado para essa finalidade, suportando os seguintes bancos de dados:</p>

<ul>
<li>MySQL</li>
<li>MongoDB</li>
<li>PostgreSQL</li>
<li>Oracle</li>
<li>SQL Server</li>
</ul>

<p>Incrementando o fluxo mostrado acima com o Debezium, teríamos uma arquitetura parecida com essa:</p>

<p><img src="/images/debezium-mysql-binlog.png" alt="Debezium + MySQL Binlog" /></p>

<p>5 - O Debezium lê o <em>binlog</em> do banco de origem <em>(5.1)</em> e produz um evento no Kafka <em>(5.2)</em> representando aquela alteração.</p>

<p>Usando o CDC para obter os eventos diretamente do banco de dados, conseguimos o benefício da consistência dos dados com a facilidade de mensageria por eventos, habilitando assim, sistemas externos reagirem às ações que ocorreram, sem perder a consistência e com baixo acoplamento. Se fizemos uma associação entre as operações SQL na tabela <code>produto</code> e os eventos, podemos definir a seguinte regra:</p>

<table>
<thead>
<tr>
<th>Operação SQL</th>
<th>Evento</th>
</tr>
</thead>

<tbody>
<tr>
<td>INSERT</td>
<td>ProdutoCriado</td>
</tr>

<tr>
<td>UPDATE</td>
<td>ProductoAtualizado</td>
</tr>

<tr>
<td>DELETE</td>
<td>ProdutoRemovido</td>
</tr>

<tr>
<td>SELECT</td>
<td>Nenhum, pois não altera o estado do registro</td>
</tr>
</tbody>
</table>

<p>Dessa forma, podemos obter todos os eventos de um sistema com uma única implementação, olhando somente para o banco de dados. Além disso, os <em>updates</em> manuais não são um problema. Mas como dito acima, toda arquitetura possui limitações, e com o CDC não seria diferente:</p>

<ul>
<li>os eventos terão apenas dados da tabela, ou seja, perdemos quaisquer dados extra, como por exemplo: dados do request, sessão do usuário&hellip;</li>
<li>para obter todos os detalhes das alterações, é necessário <a href="https://debezium.io/docs/connectors/mysql/#enabling-the-binlog">habilitar o nível mais agressivo de <em>binlog</em></a></li>
<li>se o banco de dados estiver mal modelado, será difícil consumir os eventos</li>
<li>apenas o Kafka é suportado como sistema de mensageria no Debezium</li>
</ul>

<p>No próximo <em>post</em> iremos mostrar na prática como funciona o Debezium com MySQL e Kafka.</p>

<h2 id="outros-posts-dessa-série">Outros <em>posts</em> dessa série</h2>

<ul>
<li><a href="/cdc-parte-1"><strong>CDC parte 1 - Introdução ao Change Data Capture (CDC)</strong></a> <em>(você está aqui)</em></li>
<li><strong>CDC parte 2 - CDC na prática com Debezium + MySQL</strong> <em>(irei abordar de forma prática como utilizar o Debezium para obter eventos do MySQL)</em></li>
<li><strong>CDC parte 3 - Como usamos o CDC no Elo7</strong> <em>(mostrarei como utilizamos o CDC no Elo7, dos problemas que queremos resolver até a arquitetura final da solução)</em></li>
</ul>


                        <ul class='tag-list'>
                            
                                <li>
                                    <a href='/tags/cdc/'>cdc</a>
                                </li>
                            
                                <li>
                                    <a href='/tags/debezium/'>debezium</a>
                                </li>
                            
                                <li>
                                    <a href='/tags/kafka/'>kafka</a>
                                </li>
                            
                                <li>
                                    <a href='/tags/mysql/'>mysql</a>
                                </li>
                            
                        </ul>
                        <section class='share'>
                            <a href='#share' class='share-post hide' title='Clique aqui para compartilhar esse post'>Compartilhe</a>
                            <div class='social-share'>
                                <a href='https://www.facebook.com/dialog/share?app_id=644444999041914&href=https%3a%2f%2felo7.dev%2fcdc-parte-1%2f&display=popup' rel='noopener' target='_blank' class='link-share facebook' title='Clique para compartilhar no Facebook'>
                                    Compartilhar no facebook
                                </a>
                                <a href='https://twitter.com/intent/tweet?text=introdu%25C3%25A7%25C3%25A3o-ao-change-data-capture-cdc&url=https%3a%2f%2felo7.dev%2fcdc-parte-1%2f&hashtags=elo7tech' rel='noopener' target='_blank' class='link-share twitter' title='Clique para compartilhar no Twitter'>
                                    Compartilhar no twitter
                                </a>
                                <a href='https://elo7.dev/cdc-parte-1/?utm_source=share&utm_medium=copy' class='link-share hide copy' title='Clique para copiar a url'>
                                    Copiar URL
                                </a>
                                <span class='copy-success'>Link copiado</span>
                                <input type='url' value='https://elo7.dev/cdc-parte-1/?utm_source=share&utm_medium=copy' class='link-input'>
                            </div>
                        </section>
                    </div>
                    <meta itemprop='headline' content='Vamos entender como o Change Data Capture (CDC) funciona e sua aplicabilidade para resolver nossos problemas.'/>
                    <span itemprop='publisher' itemscope itemtype='http://schema.org/Organization'>
                        <meta itemprop='name' content='Elo7 Tech'/>
                        <meta itemprop='url' content='https://elo7.dev/'/>
                        <span itemprop='logo' itemscope itemtype='http://schema.org/ImageObject'>
                            <link href='https://images.elo7.com.br/assets/v3/desktop/png/logo-elo7.png' itemprop='url'/>
                            <meta itemprop='width' content='100px'/>
                            <meta itemprop='height' content='100px'/>
                        </span>
                    </span>
                    <meta itemprop='mainEntityOfPage' content='Elo7 Serviços de Informática SA'/>

                    <div id='disqus_thread'></div>
                </div>
            </article>
        </main>

        <footer itemscope itemtype='http://schema.org/Organization'>
    <a rel='home' itemprop='url' href='https://elo7.dev/' >
        elo7.dev © <script>now = new Date; document.write(now.getFullYear());</script>
    </a>
    <meta itemprop='name' content='Elo7 Serviços de Informática SA'/>
    <section class='footer-social'>
        <a title='Github do Elo7' rel='external' itemprop='url' href='https://github.com/elo7' target='_blank' class='github'>Github do Elo7</a>
        <a title='Twitter do Elo7' rel='external' itemprop='url' href='https://twitter.com/elo7tech' target='_blank' class='twitter'>Twitter do Elo7</a>
        <a title='RSS do Elo7' rel='external' itemprop='url' href='https://elo7.dev/index.xml' target='_blank' class='rss'>RSS do Elo7</a>
        <a title='Newsletter do Elo7' rel='external' itemprop='url' href='http://eepurl.com/cVUwvH' target='_blank' class='email'>Newsletter do Elo7</a>
    </section>
</footer>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script async src='/js/analytics.js'></script>
<script async src='/js/github.js'></script>
<script async src='/js/vendor/events-amd.js'></script>
<script async src='/js/vendor/ajax.js'></script>
<script async src='/js/vendor/doc.js'></script>
<script type='text/x-mathjax-config'>
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ['\\(','\\)'] ],
            displayMath: [ ['$$','$$'], ['\[','\]'] ],
            processEscapes: true
        },
    });
</script>
<script async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
<script src='/js/vendor/highlight.js'></script>
<script>hljs.initHighlightingOnLoad();</script>


        <script>
            var disqus_shortname = 'engenhariaelo7';
            var disqus_identifier = '2019-09-23 00:00:00 \x2b0000 UTC:\/cdc-parte-1\/';
            var disqus_url = 'https:\/\/elo7.dev\/cdc-parte-1\/';

            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Habilite o JavaScript para ver os comentários</noscript>
        <script async src='/js/post.js'></script>
    </body>
</html>
